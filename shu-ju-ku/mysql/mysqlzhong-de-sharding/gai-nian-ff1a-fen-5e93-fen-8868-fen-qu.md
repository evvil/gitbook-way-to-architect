## 概念

---

**什么是分库/分表**

库即database，表即table，分库即将1个database拆分为多个database，分表即将1个table拆分为多个table。

**为什么要分**

数据库的架构演变过程：单机→读写分离（主从）→分库分表。

读写分离可以在一定程度上解决请求量太大的问题：读请求和写请求分别在不同的数据库实例上。但是，如果写请求或者读请求再增长，单机可能就无法承受，比如单机的磁盘，内存，IO等都是有限的。所以，将单库变为多库，就是一种解决方案。

如果一张表的数据量无限增大，甚至整个库就一张表，但是仍然无法存储持续到来的数据，再或者，由于数据量的持续增长，索引也会变得很大，查询也会变得很慢，此时，将单表变为多表，就是一种解决方案。

## 分库

---

所谓分库，其实就是将1个库中的n个表，拆分到多个库中，这样每个库中表的数量就减少了。所以，分库只有一种方式，就是垂直分库：按照业务模块来划分出不同的数据库。

实例TODO

## 分表

---

### **垂直分表**

垂直分表在日常开发和设计中比较常见，通俗的说法叫做“大表拆小表”，拆分是基于关系型数据库中的“列”（字段）进行的。通常情况，某个表中的字段比较多，可以新建立一张“扩展表”，将不经常使用或者长度较大的字段拆分出去放到“扩展表”中。

拆分字段的操作建议在数据库设计阶段就做好。如果是在发展过程中拆分，则需要改写以前的查询语句，会额外带来一定的成本和风险，建议谨慎。

### **水平分表**

水平分表也称为横向分表，就是将表中不同的数据行按照一定规律分布到不同的数据库表中。最常见的方式就是通过主键或者时间等字段进行Hash和取模后拆分。一般而言，拆分后的表会落到不同的数据库实例中，也称为水平分库分表。

常见的水平拆分规则如下：

**RANGE**

范围拆分，比如按照自增id来拆分，从0到10000一个表，10001到20000一个表...

**取模**

按照表中某个列的值的进行取模来拆分，比如有user\(uid, name\)和order\(uid, ...\)，则可以对user和order中的uid进行取模操作（mod = uid/\(分表的数量\)），这样同一个用户的订单就会落在同一个数据库实例中，可以避免跨库事务之类的问题。

**地理区域**

比如按照华东，华南，华北这样来区分业务。

**时间**

按照时间拆分，实现“冷热数据分离”。







## 参考

---

[数据库分库分表](https://www.cnblogs.com/405845829qq/p/7552736.html)

[分库分表的几种常见形式以及可能遇到的难](http://www.infoq.com/cn/articles/key-steps-and-likely-problems-of-split-table)

  


