# MySQL查询性能优化

---

对于MySQL，最简单的衡量查询开销的三个指标如下：

* 响应时间

* 扫描的行数

* 返回的行数

没有哪个指标能够完美地衡量查询的开销，但它们大致反映了MySQL在内部执行查询时需要访问多少数据，并可以大概推算出查询运行的时间。 这三个指标都会记录到MySQL的慢日志中。

## 优化数据访问

---

有些查询会请求超过实际需要的数据， 然后这些多余的数据会被应用程序丢弃。这会给MySQL服务器带来额外的负担， 并增加网络开销。另外也会消耗应用服务器的CPU 和内存资源。

**错误示例**：查询不需要的记录；多表关联时返回全部列；使用SELECT \* 取出全部列； 重复查询相同的数据（可以考虑缓存热点）

## 重构查询类型

---

（1）**考虑是否需要将一个复杂的查询分成多个简单的查询**；

（2）**切分查询**：如有必要，将一个大查询切分成小查询， 每个查询功能完全一样，每次只返回一小部分查询结果；

（3）**分解关联查询**：对每一个表进行一次单表查询， 然后将结果在应用程序中进行关联，这么做基于以下考虑：

* * 让缓存的效率更高。 应用程序便于缓存单表查询结果/MySQL的查询缓存单表更小概率缓存失效；
  * 将查询分解后，执行单个查询可以减少锁的竞争；
  * 在应用层做关联， 可以更容易对数据库进行拆分， 更容易做到高性能和可扩展；
  * 主要场景：当能够使用IN\(\)的方式替代关联查询的时候；当查询中使用同一个表的时候；当应用中使用单个查询结果缓存的时候；

## 利用查询优化器

---

该部分内容见：[《MySQL查询过程》](/shu-ju-ku/mysql/mysqlcha-xun-guo-cheng.md)

MySQL执行关联查询的方式——嵌套循环关联：即MySQL先在一个表中循环取出单条数据，然后再嵌套循环到下一个表中寻找匹配的行，依次下去，直到找到所有表中匹配的行为止。然后根据各个表匹配的行，返回查询中需要的各个列。MySQL会尝试在最后一个关联表中找到所有匹配的行，如果最后一个关联表无法找到更多的行以后， MySQL返回到上一层次关联表， 看是否能够找到更多的匹配记录， 依此类推迭代执行。

## 优化特定类型的查询

---



