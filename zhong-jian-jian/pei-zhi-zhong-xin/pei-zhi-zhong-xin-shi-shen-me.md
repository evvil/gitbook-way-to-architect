# 配置的特点和分类

## 概述

在系统架构中，和安全、日志、监控等非功能需求一样，配置的管理也是一种非功能需求。在没有配置中心的时候，程序中配置方式主要有以下几种：

* **程序内部硬编码**：这种做法是反模式，一般我们不建议；
* **配置文件**：比如最常见的`jdbc.properties`；
* **环境变量**：将配置预置在操作系统的环境变量里，程序运行时读取；
* **启动参数**：在程序启动时一次性提供参数；
* **基于数据库**：将配置放在数据库中，这样可以在运行期灵活调整配置；

上述的这些传统的配置方式，会存在以下问题：

* **配置散乱格式不标准：**有的用properties格式，有的用xml格式，还有的存DB，团队倾向自造轮子，做法五花八门；
* **采用本地静态配置，配置修改麻烦：**配置修改一般需要经过一个较长的测试发布周期。在分布式微服务环境下，当服务实例很多时，修改配置费时费力；
* **易引发生产事故：**比如将测试环境的配置带到生产上，引发事故；
* **缺乏安全审计：**谁改的配置？改了什么？什么时候改的？无从追溯；
* **版本控制功能：**无法查看某个配置项的修改历史，一旦出现问题无法及时回滚；



### 配置的特点

对于某个配置项（`config_key = config_value`），一般有如下属性或特点：

* 配置项的值`config_value`是一个有限空间的值集合，一般是多个值`{value1, value2, ... ...}`；
* 某个配置项，其具体的值往往跟具体的环境（开发/测试/预发/生产等）相关联，现实中相当一部分配置在不同的环境必须设定不同的值，但是也有相当的另一部分配置在不同的环境要设定为完全一致的值。比如上面的`jdbc.properties`中，`jdbc.driver`这个配置项在多个环境中一般都是一致的，但像`jdbc.url/jdbc.username/jdbc.password`这些配置项，在不同的环境中则肯定是不同的；
* 配置项的值的变更基本上都是稀疏的，即不可能非常频繁的需要进行调整；
* 一旦需要对配置项的值进行变更，则需要快速传播：使用该配置的目标集群的所有节点要几乎同时收到变更，然后几乎整齐划一的统一调整行为。比如我们需要进行切库，主备切换之后，应用集群写新的主库这个行为假如切换的很慢，整个过程收敛了一天，应用肯定是受不了的，而这个属性决定了对配置中心对配置变更推送SLA的高要求。

### 配置的分类

**静态配置**

所谓静态配置，就是在程序启动前一次性配好，启动时一次性生效，在程序运行期一般不会变化的配置。具体包括：

* **环境相关配置**：有些配置是和环境相关的，每个环境的配置不一样，例如数据库、中间件和其它服务的连接字符串配置。这些配置一次性配好，运行期一般不变。
* **安全配置**：和安全相关，例如用户名，密码，访问令牌，许可证书等，这些配置也是一次性配好，运行期一般不变。因为涉及安全，相关信息一般需要加密存储，对配置访问需要权限控制。

**动态配置**

所谓动态配置，就是在程序的运行期可以根据需要动态调整的配置。动态配置让应用行为和功能的调整变得更加灵活，是持续交付和DevOps的最佳实践。具体包括：

* **应用配置**：和应用相关的配置，例如服务请求超时，线程池和队列的大小，缓存过期时间，数据库连接池的容量，日志输出级别，限流熔断阀值，服务安全黑白名单等。一般开发或者运维会根据应用的实际运行情况调整这些配置。
* **业务配置**：和业务相关的一些配置，例如促销规则，贷款额度，利率等业务参数，A/B测试参数等。一般产品运营或开发人员会根据实际的业务需求，动态调整这些参数。
* **功能开关**：在英文中也称Feature Flag/Toggle/Switch，简单的只有真假两个值，复杂的可以是多值参数。功能开关是DevOps的一种最佳实践，在运维中有很多应用场景，比如蓝绿部署，灰度开关，降级开关，主备切换开关，数据库迁移开关等。



## 为什么需要配置中心



#### 

## 参考

[微服务架构 为什么需要配置中心](https://www.cnblogs.com/davidwang456/articles/9238281.html)[  
](http://img3.tbcdn.cn/5476e8b07b923/TB1ZzOJNpXXXXahXVXXXXXXXXXX)

